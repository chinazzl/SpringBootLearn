<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.simpleWeb.mapper.DynamicMapper">

    <!-- 动态SQL查询 -->
<!--    <select id="selectDynamic" parameterType="map" resultType="map">-->
<!--        ${sql}-->
<!--    </select>-->

    <!-- 参数化查询（更安全） -->
    <select id="selectWithParams" parameterType="map" resultType="map">
        <bind name="tableName" value="tableName"/>
        SELECT system_id FROM ${tableName}
        <where>
            <if test="whereParams != null">
                <foreach collection="whereParams" index="key" item="value" separator=" AND ">
                    ${key} = #{value}
                </foreach>
            </if>
        </where>
        <if test="orderBy != null and orderBy != ''">
            ORDER BY ${orderBy}
            <if test="sortDirection != null and sortDirection != ''">
                ${sortDirection}
            </if>
        </if>
        <if test="pageSize != null and offset != null">
            LIMIT #{pageSize} OFFSET #{offset}
        </if>
    </select>

    <!-- 计数查询 -->
    <select id="selectCount" parameterType="map" resultType="long">
        <bind name="tableName" value="tableName"/>
        SELECT COUNT(*) FROM ${tableName}
        <where>
            <if test="whereParams != null">
                <foreach collection="whereParams" index="key" item="value" separator=" AND ">
                    ${key} = #{value}
                </foreach>
            </if>
        </where>
    </select>

    <!-- 获取表信息 -->
    <select id="getTableInfo" parameterType="string" resultType="map">
        SELECT
            TABLE_NAME as tableName,
            TABLE_ROWS as tableRows,
            DATA_LENGTH as dataLength,
            INDEX_LENGTH as indexLength,
            TABLE_COMMENT as tableComment
        FROM information_schema.TABLES
        WHERE TABLE_SCHEMA = DATABASE()
          AND TABLE_NAME = #{tableName}
    </select>

    <!-- 获取表字段信息 -->
    <select id="getTableColumns" parameterType="string" resultType="map">
        SELECT
            COLUMN_NAME as columnName,
            DATA_TYPE as dataType,
            IS_NULLABLE as isNullable,
            COLUMN_DEFAULT as columnDefault,
            COLUMN_COMMENT as columnComment,
            COLUMN_KEY as columnKey
        FROM information_schema.COLUMNS
        WHERE TABLE_SCHEMA = DATABASE()
          AND TABLE_NAME = #{tableName}
        ORDER BY ORDINAL_POSITION
    </select>

    <!-- 获取数据库中所有表 -->
    <select id="getAllTables" resultType="map">
        SELECT
            TABLE_NAME as tableName,
            TABLE_ROWS as tableRows,
            DATA_LENGTH as dataLength,
            TABLE_COMMENT as tableComment
        FROM information_schema.TABLES
        WHERE TABLE_SCHEMA = DATABASE()
          AND TABLE_TYPE = 'BASE TABLE'
        ORDER BY TABLE_NAME
    </select>
</mapper>